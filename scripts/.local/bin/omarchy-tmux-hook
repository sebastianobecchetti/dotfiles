#!/bin/bash
set -euo pipefail

readonly THEME="$1"
readonly THEME_DIR="$HOME/.config/omarchy/themes/$THEME"
readonly TMUX_CONF="$HOME/.config/tmux/tmux.conf"
readonly LOCKFILE="$HOME/.cache/omarchy-tmux.lock"

reload_tmux() {
  if ! tmux list-sessions &>/dev/null; then
    return
  fi

  local pane_count
  pane_count=$(tmux list-panes -a 2>/dev/null | wc -l || echo "0")

  if [[ $pane_count -gt 0 ]]; then
    tmux source-file "$TMUX_CONF" &>/dev/null || true
    tmux refresh-client -S &>/dev/null || true
  fi
}

# Validate theme directory exists
if [[ ! -d "$THEME_DIR" ]]; then
  echo "Error: Theme directory not found at $THEME_DIR" >&2
  exit 1
fi

# Verify directory still exists
if [[ ! -d "$THEME_DIR" ]]; then
  echo "Warning: Theme directory disappeared, exiting" >&2
  exit 1
fi

reload_tmux
